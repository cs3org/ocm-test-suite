[log]
level = "debug"

[shared]
gatewaysvc = "mesh.pondersource.com:19000"

[grpc]
address = "0.0.0.0:19000"

[grpc.services.gateway]
authregistrysvc = "mesh.pondersource.com:19000"
appprovidersvc = "mesh.pondersource.com:19000"
appregistry = "mesh.pondersource.com:19000"
storageregistrysvc = "mesh.pondersource.com:19000"
preferencessvc = "mesh.pondersource.com:19000"
userprovidersvc = "mesh.pondersource.com:19000"
usershareprovidersvc = "mesh.pondersource.com:19000"
publicshareprovidersvc = "mesh.pondersource.com:19000"
ocmcoresvc = "mesh.pondersource.com:19000"
ocmshareprovidersvc = "mesh.pondersource.com:19000"
ocminvitemanagersvc = "mesh.pondersource.com:19000"
ocmproviderauthorizersvc = "mesh.pondersource.com:19000"
commit_share_to_storage_grant = false
datagateway = "https://mesh.pondersource.com/data"
transfer_expires = 6 # give it a moment

[grpc.services.authregistry]
driver = "static"

[grpc.services.authregistry.drivers.static.rules]
basic = "mesh.pondersource.com:19000"

[grpc.services.storageregistry]
driver = "static"

[grpc.services.storageregistry.drivers.static]
home_provider = "/home"

[grpc.services.storageregistry.drivers.static.rules]
"/home" = {"address" = "mesh.pondersource.com:19000"}
"00000000-0000-0000-0000-000000000000" = {"address" = "mesh.pondersource.com:19000"}

[grpc.services.usershareprovider]
driver = "memory"

[grpc.services.ocmcore]
driver = "nextcloud"

[grpc.services.ocmcore.drivers.nextcloud]
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
webdav_host = "https://cloud.pondersource.com/"
shared_secret = "shared-secret-1"
mock_http = false

[grpc.services.ocminvitemanager]
driver = "json"
provider_domain = "mesh.pondersource.com"

[grpc.services.ocmshareprovider]
driver = "nextcloud"
provider_domain = "mesh.pondersource.com"
webdav_endpoint = "https://mesh.pondersource.com"
webdav_prefix = "https://mesh.pondersource.com/remote.php/dav/files"

[grpc.services.ocmshareprovider.drivers.nextcloud]
webdav_host = "https://cloud.pondersource.com/"
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
shared_secret = "shared-secret-1"
mock_http = false

[grpc.services.ocmproviderauthorizer]
driver = "mentix"

[grpc.services.ocmproviderauthorizer.drivers.mentix]
url = "https://iop.sciencemesh.uni-muenster.de/iop/mentix/cs3"
verify_request_hostname = false
insecure = false
timeout = 10
refresh = 900

[grpc.services.publicshareprovider]
driver = "memory"

[grpc.services.appprovider]
driver = "demo"
iopsecret = "testsecret"
wopiurl = "http://0.0.0.0:8880/"
wopibridgeurl = "http://localhost:8000/wopib"

[grpc.services.appregistry]
driver = "static"

[grpc.services.appregistry.static.rules]
"text/plain" = "mesh.pondersource.com:19000"
"text/markdown" = "mesh.pondersource.com:19000"
"application/compressed-markdown" = "mesh.pondersource.com:19000"
"application/vnd.oasis.opendocument.text" = "mesh.pondersource.com:19000"
"application/vnd.oasis.opendocument.spreadsheet" = "mesh.pondersource.com:19000"
"application/vnd.oasis.opendocument.presentation" = "mesh.pondersource.com:19000"

[grpc.services.storageprovider]
driver = "nextcloud"
expose_data_server = true
data_server_url = "https://mesh.pondersource.com/data"
enable_home_creation = true

[grpc.services.storageprovider.drivers.nextcloud]
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
shared_secret = "shared-secret-1"
mock_http = false

[grpc.services.authprovider]
auth_manager = "nextcloud"

[grpc.services.authprovider.auth_managers.nextcloud]
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
shared_secret = "shared-secret-1"
mock_http = false

[grpc.services.userprovider]
driver = "nextcloud"

[grpc.services.userprovider.drivers.nextcloud]
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
shared_secret = "shared-secret-1"
mock_http = false

[http]
enabled_services = ["ocmd"]
enabled_middlewares = ["providerauthorizer", "cors"]
address = "0.0.0.0:443"
certfile = "/etc/revad/tls/revanc1.crt"
keyfile = "/etc/revad/tls/revanc1.key"

[http.services.dataprovider]
driver = "nextcloud"

[http.services.prometheus]
[http.services.sysinfo]

[http.services.dataprovider.drivers.nextcloud]
endpoint = "https://cloud.pondersource.com/index.php/apps/sciencemesh/"
shared_secret = "shared-secret-1"
mock_http = false

[http.services.ocmd]
prefix = "ocm"

[http.services.ocmd.config]
host = "mesh.pondersource.com"

[http.middlewares.providerauthorizer]
driver = "mentix"

[http.middlewares.providerauthorizer.drivers.mentix]
url = "https://iop.sciencemesh.uni-muenster.de/iop/mentix/cs3"
verify_request_hostname = false
insecure = false
timeout = 10
refresh = 900

[http.services.ocs]
prefix = "ocs"

[http.services.sciencemesh]
invite_link_template = "{{.MeshDirectoryURL}}?token={{.Token}}&providerDomain=mesh.pondersource.com"

[http.services.ocdav]
prefix = "ocdav"

[http.middlewares.cors]

[http.services.ocmprovider]
provider = "Ponder Source Mesh COM"
endpoint = "https://mesh.pondersource.com"
webdav_root = "/remote.php/dav/ocm"
enable_webapp = true
enable_datatx = true
